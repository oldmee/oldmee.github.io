<!DOCTYPE html><html lang="en-us"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 敏感词过滤算法 · oldmee</title><meta name="description" content="敏感词过滤算法 - oldmee"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://oldmee.github.io/atom.xml" title="oldmee"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://blog.csdn.net/javaer_lee" target="_blank" class="nav-list-link">CSDN</a></li><li class="nav-list-item"><a href="https://github.com/oldmee" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">敏感词过滤算法</h1><div class="post-info">Feb 26, 2013</div><div class="post-content"><blockquote><p>总的来说，敏感词过滤就是词库匹配，你定义一个词库，里面有很多敏感词，匹配到了就说明这个词是敏感词。<br>所以最简单的办法就是建立一个list，先把所有的敏感词读进这个list，然后再利用list的contains方法，就可以判断某一句话中是否有敏感词，如果有就弹个提示，告诉用户语句中有敏感词，禁止用户发送，但是如果须要把把敏感词屏蔽掉（比如用” * “号代替）这个时候contains方法就不行了，得自己写算法判断敏感词所在的位置并屏蔽掉，实现起来并不那么简单。<br><a id="more"></a><br>下面有个简单的办法，大体的思路就是构造词库的时候改变一下思路，不再是一个敏感词一组了，而是将敏感词变成一棵树，用Map集合来存放，举个例子：有个敏感词叫翻墙，那么key就是翻字（具体会转成char类型），value是一个节点对象，它有一个指向下一个字的引用，用代码描述大概是这样<code>{翻=对象类{key=墙,下一个对象{},是否是结尾}}</code>，类似的结构很常见，值得一提的是，用一个标志位来表示这棵树是否到头了，这样做有个很明显的好处，比如有两个敏感词，一个叫法轮功，一个叫法轮大法，那么这两个敏感词会存放在同一课树中，key都是法，后面是轮，完了有两个分支，一个叫功，一个叫大法，每一个字前面都有一个标志位来标记结束，功和法字的标志位都是true，因为是两个词的结尾位置。主要就在于构建这个敏感词库，有了它查询敏感词就很简单了，下面是实现代码，词库添加和搜索敏感词都是毫秒级别的，生产上完全可用。</p>
</blockquote>
<h3 id="敏感词树的节点"><a href="#敏感词树的节点" class="headerlink" title="敏感词树的节点"></a>敏感词树的节点</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SensitiveWordNode</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 节点所代表的字符</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">char</span> key;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 节点的子节点</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Character,SensitiveWordNode&gt; nextNodes;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 该节点是否为 End 节点</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> end;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SensitiveWordNode</span> <span class="params">(<span class="keyword">char</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        nextNodes = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        end = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SensitiveWordNode <span class="title">getNextNode</span> <span class="params">(<span class="keyword">char</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nextNodes.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putNextNode</span> <span class="params">(SensitiveWordNode node)</span> </span>&#123;</span><br><span class="line">        nextNodes.put (node.getKey (), node);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">getKey</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setKey</span> <span class="params">(<span class="keyword">char</span> key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map <span class="title">getNextNodes</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nextNodes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNextNodes</span> <span class="params">(Map nextNodes)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nextNodes = nextNodes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnd</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnd</span> <span class="params">(<span class="keyword">boolean</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"SensitiveWordNode&#123;"</span> +</span><br><span class="line">                <span class="string">"key="</span> + key +</span><br><span class="line">                <span class="string">", nextNodes="</span> + nextNodes +</span><br><span class="line">                <span class="string">", end="</span> + end +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="敏感词树"><a href="#敏感词树" class="headerlink" title="敏感词树"></a>敏感词树</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SensitiveWordTree</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 日志</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = Logger.getLogger(<span class="string">"SensitiveWordTree"</span>);</span><br><span class="line">    <span class="comment">// 根节点</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SensitiveWordNode root = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 敏感词库编码</span></span><br><span class="line"><span class="comment">//    private static final String ENCODING = "utf-8";</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ENCODING = <span class="string">"gbk"</span>;</span><br><span class="line">    <span class="comment">// 敏感词库位置</span></span><br><span class="line"><span class="comment">//    private static final String filePath = "/intellijProjects/resource/1.txt";</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String filePath = <span class="string">"D:/1.txt"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取敏感词库</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Set <span class="title">readSensitiveWords</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Set keyWords = <span class="keyword">new</span> HashSet();</span><br><span class="line">        BufferedReader reader = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(filePath), ENCODING));</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                keyWords.add(line.trim());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            LOG.info(<span class="string">"敏感词库编码错误!"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            LOG.info(<span class="string">"敏感词库不存在!"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            LOG.info(<span class="string">"读取敏感词库失败!"</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (reader != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    reader.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    LOG.info(<span class="string">"读取敏感词库失败!"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> keyWords;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化敏感词库</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 读取敏感词库</span></span><br><span class="line">        Set&lt;String&gt; keyWords = readSensitiveWords();</span><br><span class="line">        <span class="comment">// 初始化根节点</span></span><br><span class="line">        root = <span class="keyword">new</span> SensitiveWordNode(<span class="string">' '</span>);</span><br><span class="line">        <span class="comment">// 创建敏感词</span></span><br><span class="line">        <span class="keyword">for</span> (String keyWord : keyWords) &#123;</span><br><span class="line">            createSensitiveWordNode(keyWord);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构建敏感词</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> keyWord</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createSensitiveWordNode</span><span class="params">(String keyWord)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            LOG.info(<span class="string">"根节点不存在!"</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        SensitiveWordNode nowNode = root;</span><br><span class="line">        <span class="keyword">for</span> (Character c : keyWord.toCharArray()) &#123;</span><br><span class="line">            SensitiveWordNode nextNode = nowNode.getNextNode(c);</span><br><span class="line">            <span class="keyword">if</span> (nextNode == <span class="keyword">null</span>) &#123;</span><br><span class="line">                nextNode = <span class="keyword">new</span> SensitiveWordNode(c);</span><br><span class="line">                nowNode.putNextNode(nextNode);</span><br><span class="line">            &#125;</span><br><span class="line">            nowNode = nextNode;</span><br><span class="line">        &#125;</span><br><span class="line">        nowNode.setEnd(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检查敏感词</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 所有查出的敏感词</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">censorWords</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="keyword">null</span>) &#123;</span><br><span class="line">            init();</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuilder sensitiveWords = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        StringBuilder temp_sensitiveWords = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">char</span>[] text_to_char = text.toCharArray();</span><br><span class="line">        SensitiveWordNode sensitiveWordNode = root;</span><br><span class="line">        SensitiveWordNode this_sensitiveWordNode = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">boolean</span> flag;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> start = <span class="number">0</span>; start &lt; text_to_char.length; start++) &#123;</span><br><span class="line">            SensitiveWordNode temp_sensitiveWordNode = sensitiveWordNode.getNextNode(text_to_char[start]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (temp_sensitiveWordNode != <span class="keyword">null</span> || this_sensitiveWordNode != <span class="keyword">null</span></span><br><span class="line">                    &amp;&amp; this_sensitiveWordNode.getNextNode(text_to_char[start]) != <span class="keyword">null</span></span><br><span class="line">                    &amp;&amp; this_sensitiveWordNode.getNextNode(text_to_char[start]).getKey() == text_to_char[start]) &#123;</span><br><span class="line">                flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">                temp_sensitiveWords = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                this_sensitiveWordNode = <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (flag) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (this_sensitiveWordNode != <span class="keyword">null</span></span><br><span class="line">                        &amp;&amp; this_sensitiveWordNode.getNextNode(text_to_char[start]) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (this_sensitiveWordNode.isEnd()) &#123;</span><br><span class="line">                        sensitiveWords.append(temp_sensitiveWords + <span class="string">","</span>);</span><br><span class="line">                        this_sensitiveWordNode = <span class="keyword">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    temp_sensitiveWords = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (temp_sensitiveWordNode != <span class="keyword">null</span> &amp;&amp; temp_sensitiveWordNode.isEnd() || this_sensitiveWordNode != <span class="keyword">null</span></span><br><span class="line">                        &amp;&amp; this_sensitiveWordNode.getNextNode(text_to_char[start]) != <span class="keyword">null</span></span><br><span class="line">                        &amp;&amp; this_sensitiveWordNode.getNextNode(text_to_char[start]).getNextNodes() != <span class="keyword">null</span></span><br><span class="line">                        &amp;&amp; this_sensitiveWordNode.getNextNode(text_to_char[start]).isEnd()</span><br><span class="line">                        &amp;&amp; (start == text_to_char.length - <span class="number">1</span> </span><br><span class="line">                            || this_sensitiveWordNode.getNextNode(text_to_char[start]).getNextNodes().size() == <span class="number">0</span>)) &#123;</span><br><span class="line">                    temp_sensitiveWords.append(text_to_char[start] + <span class="string">","</span>);</span><br><span class="line">                    sensitiveWords.append(temp_sensitiveWords);</span><br><span class="line">                    temp_sensitiveWords = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">                    this_sensitiveWordNode = <span class="keyword">null</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    temp_sensitiveWords.append(text_to_char[start]);</span><br><span class="line">                    <span class="keyword">if</span> (this_sensitiveWordNode == <span class="keyword">null</span>) &#123;</span><br><span class="line">                        this_sensitiveWordNode = temp_sensitiveWordNode;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (this_sensitiveWordNode != <span class="keyword">null</span></span><br><span class="line">                            &amp;&amp; this_sensitiveWordNode.getNextNode(text_to_char[start]) != <span class="keyword">null</span></span><br><span class="line">                            &amp;&amp; this_sensitiveWordNode.getNextNode(text_to_char[start]).getNextNodes().size() != <span class="number">0</span>) &#123;</span><br><span class="line">                        this_sensitiveWordNode = this_sensitiveWordNode.getNextNode(text_to_char[start]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sensitiveWords.length() &gt; <span class="number">0</span> ? </span><br><span class="line">                sensitiveWords.subSequence(<span class="number">0</span>, sensitiveWords.length() - <span class="number">1</span>).toString() </span><br><span class="line">                : <span class="string">"未匹配到敏感词"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start_time = System.currentTimeMillis();</span><br><span class="line">        init();</span><br><span class="line">        System.out.println(System.currentTimeMillis() - start_time);</span><br><span class="line">        System.out.println(root);</span><br><span class="line">        start_time = System.currentTimeMillis();</span><br><span class="line">        String list = censorWords(<span class="string">"语文数，学数学，学英英语语文文"</span>);</span><br><span class="line">        System.out.println(System.currentTimeMillis() - start_time);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br><br><br><br><blockquote><p>下面这种算法的核心跟上面类似，只不过加入了符号识别和大小写以及全角半角识别，识别率更好一些。</p>
</blockquote></p>
<h3 id="敏感词节点"><a href="#敏感词节点" class="headerlink" title="敏感词节点"></a>敏感词节点</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordNode</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> value; <span class="comment">// 节点名称</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> List&lt;WordNode&gt; subNodes; <span class="comment">// 子节点</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> isLast;<span class="comment">// 默认false</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">WordNode</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.value = value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">WordNode</span><span class="params">(<span class="keyword">int</span> value, <span class="keyword">boolean</span> isLast)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.value = value;</span><br><span class="line">		<span class="keyword">this</span>.isLast = isLast;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> subNode</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 就是传入的subNode</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> WordNode <span class="title">addSubNode</span><span class="params">(<span class="keyword">final</span> WordNode subNode)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (subNodes == <span class="keyword">null</span>)</span><br><span class="line">			subNodes = <span class="keyword">new</span> LinkedList&lt;WordNode&gt;();</span><br><span class="line">		subNodes.add(subNode);</span><br><span class="line">		<span class="keyword">return</span> subNode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 有就直接返回该子节点， 没有就创建添加并返回该子节点</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> WordNode <span class="title">addIfNoExist</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> value, <span class="keyword">final</span> <span class="keyword">boolean</span> isLast)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (subNodes == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> addSubNode(<span class="keyword">new</span> WordNode(value, isLast));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (WordNode subNode : subNodes) &#123;</span><br><span class="line">			<span class="keyword">if</span> (subNode.value == value) &#123;</span><br><span class="line">				<span class="keyword">if</span> (!subNode.isLast &amp;&amp; isLast)</span><br><span class="line">					subNode.isLast = <span class="keyword">true</span>;</span><br><span class="line">				<span class="keyword">return</span> subNode;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> addSubNode(<span class="keyword">new</span> WordNode(value, isLast));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> WordNode <span class="title">querySub</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (subNodes == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (WordNode subNode : subNodes) &#123;</span><br><span class="line">			<span class="keyword">if</span> (subNode.value == value)</span><br><span class="line">				<span class="keyword">return</span> subNode;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> isLast;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLast</span><span class="params">(<span class="keyword">boolean</span> isLast)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.isLast = isLast;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="敏感词树-1"><a href="#敏感词树-1" class="headerlink" title="敏感词树"></a>敏感词树</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> FilterSet set = <span class="keyword">new</span> FilterSet(); <span class="comment">// 存储首字</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Integer, WordNode&gt; nodes = <span class="keyword">new</span> HashMap&lt;Integer, WordNode&gt;(<span class="number">1024</span>, <span class="number">1</span>); <span class="comment">// 存储节点</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;Integer&gt; stopwdSet = <span class="keyword">new</span> HashSet&lt;&gt;(); <span class="comment">// 停顿词</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> SIGN = <span class="string">'*'</span>; <span class="comment">// 敏感词过滤替换</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">long</span> a = System.nanoTime();</span><br><span class="line">			init();</span><br><span class="line">			a = System.nanoTime() - a;</span><br><span class="line">			System.out.println(<span class="string">"加载时间 : "</span> + a + <span class="string">"ns"</span>);</span><br><span class="line">			System.out.println(<span class="string">"加载时间 : "</span> + a / <span class="number">1000000</span> + <span class="string">"ms"</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"初始化过滤器失败"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 获取敏感词</span></span><br><span class="line">		addSensitiveWord(readWordFromFile(<span class="string">"wd.txt"</span>));</span><br><span class="line">		addStopWord(readWordFromFile(<span class="string">"stopwd.txt"</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 增加敏感词</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> path</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">readWordFromFile</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">		List&lt;String&gt; words;</span><br><span class="line">		BufferedReader br = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(WordFilter.class.getClassLoader().getResourceAsStream(path),<span class="string">"UTF-8"</span>));</span><br><span class="line">			words = <span class="keyword">new</span> ArrayList&lt;String&gt;(<span class="number">1200</span>);</span><br><span class="line">			<span class="keyword">for</span> (String buf = <span class="string">""</span>; (buf = br.readLine()) != <span class="keyword">null</span>;) &#123;</span><br><span class="line">				<span class="keyword">if</span> (buf == <span class="keyword">null</span> || buf.trim().equals(<span class="string">""</span>))</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				words.add(buf);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (br != <span class="keyword">null</span>)</span><br><span class="line">					br.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> words;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 增加停顿词</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> words</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addStopWord</span><span class="params">(<span class="keyword">final</span> List&lt;String&gt; words)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (words != <span class="keyword">null</span> &amp;&amp; words.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">char</span>[] chs;</span><br><span class="line">			<span class="keyword">for</span> (String curr : words) &#123;</span><br><span class="line">				chs = curr.toCharArray();</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">char</span> c : chs) &#123;</span><br><span class="line">					stopwdSet.add(charConvert(c));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 添加DFA节点</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> words</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addSensitiveWord</span><span class="params">(<span class="keyword">final</span> List&lt;String&gt; words)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (words != <span class="keyword">null</span> &amp;&amp; words.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">char</span>[] chs;</span><br><span class="line">			<span class="keyword">int</span> fchar;</span><br><span class="line">			<span class="keyword">int</span> lastIndex;</span><br><span class="line">			WordNode fnode; <span class="comment">// 首字母节点</span></span><br><span class="line">			<span class="keyword">for</span> (String curr : words) &#123;</span><br><span class="line">				chs = curr.toCharArray();</span><br><span class="line">				fchar = charConvert(chs[<span class="number">0</span>]);</span><br><span class="line">				<span class="keyword">if</span> (!set.contains(fchar)) &#123;<span class="comment">// 没有首字定义</span></span><br><span class="line">					set.add(fchar);<span class="comment">// 首字标志位 可重复add,反正判断了，不重复了</span></span><br><span class="line">					fnode = <span class="keyword">new</span> WordNode(fchar, chs.length == <span class="number">1</span>);</span><br><span class="line">					nodes.put(fchar, fnode);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					fnode = nodes.get(fchar);</span><br><span class="line">					<span class="keyword">if</span> (!fnode.isLast() &amp;&amp; chs.length == <span class="number">1</span>)</span><br><span class="line">						fnode.setLast(<span class="keyword">true</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				lastIndex = chs.length - <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; chs.length; i++) &#123;</span><br><span class="line">					fnode = fnode.addIfNoExist(charConvert(chs[i]), i == lastIndex);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 过滤判断 将敏感词转化为成屏蔽词</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> src</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title">doFilter</span><span class="params">(<span class="keyword">final</span> String src)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">char</span>[] chs = src.toCharArray();</span><br><span class="line">		<span class="keyword">int</span> length = chs.length;</span><br><span class="line">		<span class="keyword">int</span> currc;</span><br><span class="line">		<span class="keyword">int</span> k;</span><br><span class="line">		WordNode node;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">			currc = charConvert(chs[i]);</span><br><span class="line">			<span class="keyword">if</span> (!set.contains(currc)) &#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			node = nodes.get(currc);<span class="comment">// 日 2</span></span><br><span class="line">			<span class="keyword">if</span> (node == <span class="keyword">null</span>)<span class="comment">// 其实不会发生，习惯性写上了</span></span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">boolean</span> couldMark = <span class="keyword">false</span>;</span><br><span class="line">			<span class="keyword">int</span> markNum = -<span class="number">1</span>;</span><br><span class="line">			<span class="keyword">if</span> (node.isLast()) &#123;<span class="comment">// 单字匹配（日）</span></span><br><span class="line">				couldMark = <span class="keyword">true</span>;</span><br><span class="line">				markNum = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 继续匹配（日你/日你妹），以长的优先</span></span><br><span class="line">			<span class="comment">// 你-3 妹-4 夫-5</span></span><br><span class="line">			k = i;</span><br><span class="line">			<span class="keyword">for</span> (; ++k &lt; length;) &#123;</span><br><span class="line">				<span class="keyword">int</span> temp = charConvert(chs[k]);</span><br><span class="line">				<span class="keyword">if</span> (stopwdSet.contains(temp))</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				node = node.querySub(temp);</span><br><span class="line">				<span class="keyword">if</span> (node == <span class="keyword">null</span>)<span class="comment">// 没有了</span></span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">if</span> (node.isLast()) &#123;</span><br><span class="line">					couldMark = <span class="keyword">true</span>;</span><br><span class="line">					markNum = k - i;<span class="comment">// 3-2</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (couldMark) &#123;</span><br><span class="line">				<span class="keyword">for</span> (k = <span class="number">0</span>; k &lt;= markNum; k++) &#123;</span><br><span class="line">					chs[k + i] = SIGN;</span><br><span class="line">				&#125;</span><br><span class="line">				i = i + markNum;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> String(chs);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 是否包含敏感词</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> src</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">isContains</span><span class="params">(<span class="keyword">final</span> String src)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">char</span>[] chs = src.toCharArray();</span><br><span class="line">		<span class="keyword">int</span> length = chs.length;</span><br><span class="line">		<span class="keyword">int</span> currc;</span><br><span class="line">		<span class="keyword">int</span> k;</span><br><span class="line">		WordNode node;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">			currc = charConvert(chs[i]);</span><br><span class="line">			<span class="keyword">if</span> (!set.contains(currc)) &#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			node = nodes.get(currc);<span class="comment">// 日 2</span></span><br><span class="line">			<span class="keyword">if</span> (node == <span class="keyword">null</span>)<span class="comment">// 其实不会发生，习惯性写上了</span></span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">boolean</span> couldMark = <span class="keyword">false</span>;</span><br><span class="line">			<span class="keyword">if</span> (node.isLast()) &#123;<span class="comment">// 单字匹配（日）</span></span><br><span class="line">				couldMark = <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 继续匹配（日你/日你妹），以长的优先</span></span><br><span class="line">			<span class="comment">// 你-3 妹-4 夫-5</span></span><br><span class="line">			k = i;</span><br><span class="line">			<span class="keyword">for</span> (; ++k &lt; length;) &#123;</span><br><span class="line">				<span class="keyword">int</span> temp = charConvert(chs[k]);</span><br><span class="line">				<span class="keyword">if</span> (stopwdSet.contains(temp))</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				node = node.querySub(temp);</span><br><span class="line">				<span class="keyword">if</span> (node == <span class="keyword">null</span>)<span class="comment">// 没有了</span></span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">if</span> (node.isLast()) &#123;</span><br><span class="line">					couldMark = <span class="keyword">true</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (couldMark) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 大写转化为小写 全角转化为半角</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> src</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">charConvert</span><span class="params">(<span class="keyword">char</span> src)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> r = BCConvert.qj2bj(src);</span><br><span class="line">		<span class="keyword">return</span> (r &gt;= <span class="string">'A'</span> &amp;&amp; r &lt;= <span class="string">'Z'</span>) ? r + <span class="number">32</span> : r;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span>  <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">		System.out.println(doFilter(<span class="string">"日%%##你你妈"</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="FilterSet，枚举了0-65535的所有char是否是某个敏感词开头的状态"><a href="#FilterSet，枚举了0-65535的所有char是否是某个敏感词开头的状态" class="headerlink" title="FilterSet，枚举了0~65535的所有char是否是某个敏感词开头的状态"></a>FilterSet，枚举了0~65535的所有char是否是某个敏感词开头的状态</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FilterSet</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span>[] elements;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FilterSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		 elements = <span class="keyword">new</span> <span class="keyword">long</span>[<span class="number">1</span> + (<span class="number">65535</span> &gt;&gt;&gt; <span class="number">6</span>)];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line">		elements[no &gt;&gt;&gt; <span class="number">6</span>] |= (<span class="number">1L</span> &lt;&lt; (no &amp; <span class="number">63</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span>... no)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> currNo : no)</span><br><span class="line">			elements[currNo &gt;&gt;&gt; <span class="number">6</span>] |= (<span class="number">1L</span> &lt;&lt; (currNo &amp; <span class="number">63</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line">		elements[no &gt;&gt;&gt; <span class="number">6</span>] &amp;= ~(<span class="number">1L</span> &lt;&lt; (no &amp; <span class="number">63</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> no</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> true:添加成功	false:原已包含</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAndNotify</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> eWordNum = no &gt;&gt;&gt; <span class="number">6</span>;</span><br><span class="line">		<span class="keyword">long</span> oldElements = elements[eWordNum];</span><br><span class="line">		elements[eWordNum] |= (<span class="number">1L</span> &lt;&lt; (no &amp; <span class="number">63</span>));</span><br><span class="line">		<span class="keyword">boolean</span> result = elements[eWordNum] != oldElements;</span><br><span class="line"><span class="comment">//		if (result)</span></span><br><span class="line"><span class="comment">//			size++;</span></span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> no</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> true:移除成功	false:原本就不包含</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAndNotify</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> eWordNum = no &gt;&gt;&gt; <span class="number">6</span>;</span><br><span class="line">		<span class="keyword">long</span> oldElements = elements[eWordNum];</span><br><span class="line">		elements[eWordNum] &amp;= ~(<span class="number">1L</span> &lt;&lt; (no &amp; <span class="number">63</span>));</span><br><span class="line">		<span class="keyword">boolean</span> result = elements[eWordNum] != oldElements;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> no)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (elements[no &gt;&gt;&gt; <span class="number">6</span>] &amp; (<span class="number">1L</span> &lt;&lt; (no &amp; <span class="number">63</span>))) != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsAll</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span>... no)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(no.length==<span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> currNo : no)</span><br><span class="line">			<span class="keyword">if</span>((elements[currNo &gt;&gt;&gt; <span class="number">6</span>] &amp; (<span class="number">1L</span> &lt;&lt; (currNo &amp; <span class="number">63</span>))) == <span class="number">0</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 不如直接循环调用contains</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> no</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">containsAll_ueslessWay</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span>... no)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">long</span>[] elements = <span class="keyword">new</span> <span class="keyword">long</span>[<span class="keyword">this</span>.elements.length];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> currNo : no)&#123;</span><br><span class="line">			elements[currNo &gt;&gt;&gt; <span class="number">6</span>] |= (<span class="number">1L</span> &lt;&lt; (currNo &amp; <span class="number">63</span>));</span><br><span class="line">		&#125;<span class="comment">//这一步执行完跟循环调用contains差不多了</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; elements.length; i++)</span><br><span class="line">			<span class="keyword">if</span> ((elements[i] &amp; ~<span class="keyword">this</span>.elements[i]) != <span class="number">0</span>)</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 目前没有去维护size，每次都是去计算size</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">long</span> element : elements)</span><br><span class="line">			size += Long.bitCount(element);</span><br><span class="line">		<span class="keyword">return</span> size;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		FilterSet oi = <span class="keyword">new</span> FilterSet();</span><br><span class="line">		System.out.println(oi.elements.length);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="全角-半角转换"><a href="#全角-半角转换" class="headerlink" title="全角/半角转换"></a>全角/半角转换</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BCConvert</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ASCII表中可见字符从!开始，偏移位值为33(Decimal)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> DBC_CHAR_START = <span class="number">33</span>; <span class="comment">// 半角!</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ASCII表中可见字符到~结束，偏移位值为126(Decimal)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> DBC_CHAR_END = <span class="number">126</span>; <span class="comment">// 半角~</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 全角对应于ASCII表的可见字符从！开始，偏移值为65281</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> SBC_CHAR_START = <span class="number">65281</span>; <span class="comment">// 全角！</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 全角对应于ASCII表的可见字符到～结束，偏移值为65374</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> SBC_CHAR_END = <span class="number">65374</span>; <span class="comment">// 全角～</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ASCII表中除空格外的可见字符与对应的全角字符的相对偏移</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONVERT_STEP = <span class="number">65248</span>; <span class="comment">// 全角半角转换间隔</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 全角空格的值，它没有遵从与ASCII的相对偏移，必须单独处理</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> SBC_SPACE = <span class="number">12288</span>; <span class="comment">// 全角空格 12288</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 半角空格的值，在ASCII中为32(Decimal)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">char</span> DBC_SPACE = <span class="string">' '</span>; <span class="comment">// 半角空格</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * &lt;PRE&gt;</span></span><br><span class="line"><span class="comment">	 * 半角字符-&gt;全角字符转换  </span></span><br><span class="line"><span class="comment">	 * 只处理空格，!到˜之间的字符，忽略其他</span></span><br><span class="line"><span class="comment">	 * &lt;/PRE&gt;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">bj2qj</span><span class="params">(String src)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (src == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> src;</span><br><span class="line">		&#125;</span><br><span class="line">		StringBuilder buf = <span class="keyword">new</span> StringBuilder(src.length());</span><br><span class="line">		<span class="keyword">char</span>[] ca = src.toCharArray();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ca.length; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (ca[i] == DBC_SPACE) &#123; <span class="comment">// 如果是半角空格，直接用全角空格替代</span></span><br><span class="line">				buf.append(SBC_SPACE);</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ((ca[i] &gt;= DBC_CHAR_START) &amp;&amp; (ca[i] &lt;= DBC_CHAR_END)) &#123; <span class="comment">// 字符是!到~之间的可见字符</span></span><br><span class="line">				buf.append((<span class="keyword">char</span>) (ca[i] + CONVERT_STEP));</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123; <span class="comment">// 不对空格以及ascii表中其他可见字符之外的字符做任何处理</span></span><br><span class="line">				buf.append(ca[i]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> buf.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 半角转换全角</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> src</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">bj2qj</span><span class="params">(<span class="keyword">char</span> src)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> r = src;</span><br><span class="line">		<span class="keyword">if</span> (src == DBC_SPACE) &#123; <span class="comment">// 如果是半角空格，直接用全角空格替代</span></span><br><span class="line">			src = SBC_SPACE;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> ((src &gt;= DBC_CHAR_START) &amp;&amp; (src &lt;= DBC_CHAR_END)) &#123; <span class="comment">// 字符是!到~之间的可见字符</span></span><br><span class="line">			r = src + CONVERT_STEP;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> r;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * &lt;PRE&gt;</span></span><br><span class="line"><span class="comment">	 * 全角字符-&gt;半角字符转换  </span></span><br><span class="line"><span class="comment">	 * 只处理全角的空格，全角！到全角～之间的字符，忽略其他</span></span><br><span class="line"><span class="comment">	 * &lt;/PRE&gt;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">qj2bj</span><span class="params">(String src)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (src == <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> src;</span><br><span class="line">		&#125;</span><br><span class="line">		StringBuilder buf = <span class="keyword">new</span> StringBuilder(src.length());</span><br><span class="line">		<span class="keyword">char</span>[] ca = src.toCharArray();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; src.length(); i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (ca[i] &gt;= SBC_CHAR_START &amp;&amp; ca[i] &lt;= SBC_CHAR_END) &#123; <span class="comment">// 如果位于全角！到全角～区间内</span></span><br><span class="line">				buf.append((<span class="keyword">char</span>) (ca[i] - CONVERT_STEP));</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (ca[i] == SBC_SPACE) &#123; <span class="comment">// 如果是全角空格</span></span><br><span class="line">				buf.append(DBC_SPACE);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123; <span class="comment">// 不处理全角空格，全角！到全角～区间外的字符</span></span><br><span class="line">				buf.append(ca[i]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> buf.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 全角转换半角</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> src</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">qj2bj</span><span class="params">(<span class="keyword">char</span> src)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> r = src;</span><br><span class="line">		<span class="keyword">if</span> (src &gt;= SBC_CHAR_START &amp;&amp; src &lt;= SBC_CHAR_END) &#123; <span class="comment">// 如果位于全角！到全角～区间内</span></span><br><span class="line">			r = src - CONVERT_STEP;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (src == SBC_SPACE) &#123; <span class="comment">// 如果是全角空格</span></span><br><span class="line">			r = DBC_SPACE;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> r;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上两种写法的代码我都托管在了<a href="https://github.com/oldmee/sensitive-word-filter" target="_blank" rel="noopener">这个地址</a>上，当然最好还是自己动手写一写，这样更便于理解。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2013/03/05/Cross-Domain/" class="prev">上一篇</a><a href="/2012/03/04/atement-PreparedStatement/" class="next">下一篇</a></div><div class="copyright"><p>© 2012 - 2019 <a href="https://oldmee.github.io">oldmee</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>